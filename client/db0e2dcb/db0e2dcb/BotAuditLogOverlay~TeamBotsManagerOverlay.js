(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{10126:function(e,t,r){"use strict";var o=r(0);r(9),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a,l,n,s,u=o(r(6)),d=o(r(3)),p=r(30),c=o(r(34)),f=o(r(672)),y=o(r(35)),g=r(220),h=o(r(81)),m=o(r(182)),b=o(r(1)),v=r(2),O=r(4);var T=(i=(0,o(r(10)).default)({name:"BotAuditLogErrorIcon",loader:()=>r(10127)}),a=(0,c.default)([p.ContextMenuOverlay]),l=v.computed.struct,i(n=(0,O.observer)(n=a((s=class extends b.default.Component{constructor(...e){super(...e),this._handleContextMenu=e=>{const{menuSpecs:t}=this;this.ContextMenuOverlay.Open({portalTriggerContainer:(0,g.GetEmulatedContainerAtClick)(e),menuSpecs:t})}}get auditLogItem(){return this.props.auditLogItem}get diagnosticInfo(){var e,t;const{auditLogItem:r}=this;return{botId:r.botId,botFlowId:r.botFlowId,teamId:null===(e=r.data)||void 0===e?void 0:e.teamId,auditLogId:r.id,sentryEventId:null===(t=r.data)||void 0===t?void 0:t.sentryEventId}}get menuSpecs(){const{diagnosticInfo:e}=this;return{sections:[{name:"Developer",actions:[{label:"Copy diagnostic info",id:"copy-diagnostic-info",icon:"icon-clipboard",textToCopy:JSON.stringify(e,null,2),clipboardLogEvent:y.default.CopyAuditLogErrorDiagnosticInfoAttempt,itemTemplate:f.default}]}]}}get errorText(){var e;const{auditLogItem:t}=this;let r="";return(null===(e=t.data)||void 0===e?void 0:e.errorMessage)?r+='Error running flow: "'.concat(t.data.errorMessage,"\" â€“ Please check your flow's configuration"):r+="Error running flow. It has been logged and reported to support",h.default.GuildedInternalDeveloperMode&&(r+=" (Developer Mode: right click for options)"),r}render(){return(0,u.default)(m.default,{flavor:"remove",onContextMenu:h.default.GuildedInternalDeveloperMode&&this._handleContextMenu,text:this.errorText,iconName:"icon-failed-send"})}},(0,d.default)(s.prototype,"auditLogItem",[v.computed],Object.getOwnPropertyDescriptor(s.prototype,"auditLogItem"),s.prototype),(0,d.default)(s.prototype,"diagnosticInfo",[l],Object.getOwnPropertyDescriptor(s.prototype,"diagnosticInfo"),s.prototype),(0,d.default)(s.prototype,"menuSpecs",[v.computed],Object.getOwnPropertyDescriptor(s.prototype,"menuSpecs"),s.prototype),(0,d.default)(s.prototype,"errorText",[v.computed],Object.getOwnPropertyDescriptor(s.prototype,"errorText"),s.prototype),n=s))||n)||n)||n);t.default=T},10127:function(e,t,r){var o=r(7),i=r(10128);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var a,l=0,n={injectType:"lazyStyleTag",insert:"head",singleton:!1},s={};i.locals&&(s.locals=i.locals),s.use=function(e){return l++||(a=o(i,{...n,...e})),s},s.unuse=function(){l>0&&!--l&&(a(),a=null)},e.exports=s},10128:function(e,t,r){(t=r(8)(!1)).push([e.i,"",""]),e.exports=t},10129:function(e,t,r){"use strict";var o=r(19),i=r(0);r(9),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,r,o,i,w,A,L,D,P,M,j,F,V,x,E;return t=T.observable.ref,r=T.observable.struct,o=T.computed.struct,i=T.computed.struct,w=(0,T.computed)(c.default),(0,v.default)(A=(0,b.default)(A=(0,m.default)(A=(0,h.default)(A=(0,g.default)(A=(0,O.default)((E=x=class extends e{constructor(...e){super(...e),this.PageSize=50,(0,l.default)(this,"auditActions",D,this),(0,l.default)(this,"hasMoreItemsToFetch",P,this),(0,l.default)(this,"filters",M,this),this.reactions=[{dataFn:()=>this.props.bot,reaction:()=>{this.hasMoreItemsToFetch=!0,this.auditActions=[],this.refetch()}}],this.fetchData=()=>{const{requestArgs:e}=this;return y.default.GetBotLogs(e)},(0,l.default)(this,"handleDataFetch",j,this),this._getEntityFilterOptions=({entityType:e})=>{const{bot:t}=this.props,r=t.flows.reduce((t,r)=>{const o=p.BotEntityTypePropertyNamesByBotEntityType[e],i=d.default[e],a=r[o];return t[a]={id:a,value:a,label:i[a].title},t},{});return Object.values(r)},(0,l.default)(this,"onFiltersChange",F,this),(0,l.default)(this,"onLoadNextPage",V,this)}get hasMoreItemsToDisplay(){return this.hasMoreItemsToFetch&&!this.props.loadingDisabled}get requestArgs(){const{teamId:e}=this.teamContext,{bot:t,flow:r}=this.props;return{teamId:e,botId:t.id,maxItems:this.PageSize,botFlowIds:(null==r?void 0:r.id)?[r.id]:null,beforeDate:this.beforeDate,actionTypes:this.filterActionType,triggerTypes:this.filterTriggerType,originatorId:this.filterOriginatorId,error:this.filterError,when:this.filterWhen}}get ItemManagementSpecs(){return{values:{[I.Originator]:{label:"Originator",itemKey:"originatorId"},[I.TriggerType]:{label:"Trigger",itemKey:"triggerType"},[I.ActionType]:{label:"Action",itemKey:"actionType"},[I.When]:{label:"When",itemKey:"createdAt"},[I.Error]:{label:"",itemKey:"error"}},columns:{[I.Originator]:{valueKey:I.Originator,valueRenderer:this.RenderOriginatorName,style:{maxWidth:180}},[I.TriggerType]:{valueKey:I.TriggerType,valueRenderer:this.RenderTriggerType,style:{maxWidth:600}},[I.ActionType]:{valueKey:I.ActionType,valueRenderer:this.RenderActionType,style:{maxWidth:600}},[I.When]:{valueKey:I.When,valueRenderer:this.RenderWhen,overrideStyle:{width:60}},[I.Error]:{valueKey:I.Error,valueRenderer:this.RenderError,overrideStyle:{width:30}}},sort:{[I.When]:{priority:1,compareFunc:s.default.Date,isSystemSortOnly:!0}},filter:{[I.Originator]:{options:this.originatorFilterOptions,allOptionLabel:"All originators",isMulti:!1,priority:1},[I.TriggerType]:{options:this.triggerFilterOptions,allOptionLabel:"All triggers",isMulti:!0,priority:2},[I.ActionType]:{options:this.actionFilterOptions,allOptionLabel:"All actions",isMulti:!0,priority:3},[I.When]:{options:f.default.DateFilterOptions,allOptionLabel:"All time",isMulti:!1,priority:4},[I.Error]:{options:[{id:"no",value:!1,label:"Success"},{id:"yes",value:!0,label:"Error"}],label:"Outcome",allOptionLabel:"Any outcome",isMulti:!1,priority:5}},itemOptions:{getCanView:this.getCanViewItemOptions,onOpen:this.onOpenItemOptions},defaultValues:{sortKey:I.When},display:{label:"latest trigger"},asyncOptions:{onFiltersChange:this.onFiltersChange,onLoadNextPage:this.onLoadNextPage}}}get actionFilterOptions(){return this._getEntityFilterOptions({entityType:p.default.Action})}get triggerFilterOptions(){return this._getEntityFilterOptions({entityType:p.default.Trigger})}get originatorFilterOptions(){var e;return((null===(e=this.teamContext.teamInfo)||void 0===e?void 0:e.activeMembers)||[]).map(e=>({color:e.roleColor,color2:e.roleColor2,id:e.id,value:e.id,label:e.displayName}))}get filterActionType(){var e,t;return null===(e=this.filters)||void 0===e?void 0:null===(t=e[I.ActionType])||void 0===t?void 0:t.map(e=>e.value)}get filterTriggerType(){var e,t;return null===(e=this.filters)||void 0===e?void 0:null===(t=e[I.TriggerType])||void 0===t?void 0:t.map(e=>e.value)}get filterOriginatorId(){var e,t,r;return null===(e=this.filters)||void 0===e?void 0:null===(t=e[I.Originator])||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.value}get filterWhen(){var e,t;const r=(null===(e=this.filters)||void 0===e?void 0:null===(t=e[I.When])||void 0===t?void 0:t[0])||null;return r?u.default.GetWhenFilterParameter(r):null}get filterError(){var e,t,r;const o=null===(e=this.filters)||void 0===e?void 0:null===(t=e[I.Error])||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.value;return"boolean"==typeof o?o:null}get beforeDate(){const{auditActions:e}=this;return e.length?e[e.length-1].createdAt:null}},x.displayName=e.displayName||e.name,L=E,D=(0,n.default)(L.prototype,"auditActions",[t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),P=(0,n.default)(L.prototype,"hasMoreItemsToFetch",[T.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),M=(0,n.default)(L.prototype,"filters",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),(0,n.default)(L.prototype,"hasMoreItemsToDisplay",[T.computed],Object.getOwnPropertyDescriptor(L.prototype,"hasMoreItemsToDisplay"),L.prototype),(0,n.default)(L.prototype,"requestArgs",[o],Object.getOwnPropertyDescriptor(L.prototype,"requestArgs"),L.prototype),j=(0,n.default)(L.prototype,"handleDataFetch",[T.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return e=>this.auditActions=e}}),(0,n.default)(L.prototype,"ItemManagementSpecs",[i],Object.getOwnPropertyDescriptor(L.prototype,"ItemManagementSpecs"),L.prototype),(0,n.default)(L.prototype,"actionFilterOptions",[T.computed],Object.getOwnPropertyDescriptor(L.prototype,"actionFilterOptions"),L.prototype),(0,n.default)(L.prototype,"triggerFilterOptions",[T.computed],Object.getOwnPropertyDescriptor(L.prototype,"triggerFilterOptions"),L.prototype),(0,n.default)(L.prototype,"filterActionType",[T.computed],Object.getOwnPropertyDescriptor(L.prototype,"filterActionType"),L.prototype),(0,n.default)(L.prototype,"filterTriggerType",[T.computed],Object.getOwnPropertyDescriptor(L.prototype,"filterTriggerType"),L.prototype),(0,n.default)(L.prototype,"filterOriginatorId",[T.computed],Object.getOwnPropertyDescriptor(L.prototype,"filterOriginatorId"),L.prototype),(0,n.default)(L.prototype,"filterWhen",[T.computed],Object.getOwnPropertyDescriptor(L.prototype,"filterWhen"),L.prototype),(0,n.default)(L.prototype,"filterError",[T.computed],Object.getOwnPropertyDescriptor(L.prototype,"filterError"),L.prototype),F=(0,n.default)(L.prototype,"onFiltersChange",[T.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return e=>{this.filters=e,this.hasMoreItemsToFetch=!0,this.auditActions=[],this.refetch()}}}),(0,n.default)(L.prototype,"beforeDate",[w],Object.getOwnPropertyDescriptor(L.prototype,"beforeDate"),L.prototype),V=(0,n.default)(L.prototype,"onLoadNextPage",[T.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return(0,a.coroutine)((function*(){if(!e.hasMoreItemsToFetch)return;const{requestArgs:t}=e,r=yield e.makeRequest(y.default.GetBotLogs(t));(0,T.runInAction)(()=>{e.hasMoreItemsToFetch=r.length===e.PageSize,e.auditActions=[...e.auditActions,...r]})}))}}),A=L))||A)||A)||A)||A)||A)||A},t.BotAuditLogValueKeys=void 0;var a=r(14),l=i(r(12)),n=i(r(3)),s=(i(r(13)),i(r(8083))),u=i(r(4871)),d=i(r(10130)),p=o(r(1619)),c=i(r(106)),f=i(r(4866)),y=i(r(1614)),g=i(r(46)),h=i(r(56)),m=i(r(22)),b=i(r(25)),v=i(r(39)),O=i(r(37)),T=r(2);const I={TriggerType:"triggerType",ActionType:"actionType",Originator:"originator",When:"when",Error:"error"};t.BotAuditLogValueKeys=I},10130:function(e,t,r){"use strict";var o=r(16);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(r(1619)),a=o(r(1630)),l=o(r(1629)),n={[i.default.Action]:l.default,[i.default.Trigger]:a.default};t.default=n},10131:function(e,t,r){var o=r(7),i=r(10132);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var a,l=0,n={injectType:"lazyStyleTag",insert:"head",singleton:!1},s={};i.locals&&(s.locals=i.locals),s.use=function(e){return l++||(a=o(i,{...n,...e})),s},s.unuse=function(){l>0&&!--l&&(a(),a=null)},e.exports=s},10132:function(e,t,r){(t=r(8)(!1)).push([e.i,".BotAuditLog-originator-column{max-width:100%}",""]),e.exports=t},4866:function(e,t,r){"use strict";var o=r(0);r(9),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(r(55));const a=[{id:"Last7Days",label:"Last 1 to 7 days",lowerValue:(0,i.default)().subtract(7,"days"),upperValue:(0,i.default)().subtract(24,"hours")},{id:"Last31Days",label:"Last 7 to 31 days",lowerValue:(0,i.default)().subtract(31,"days"),upperValue:(0,i.default)().subtract(7,"days")},{id:"Last90Days",label:"Last 31 to 90 days",lowerValue:(0,i.default)().subtract(90,"days"),upperValue:(0,i.default)().subtract(31,"days")},{id:"MoreThan90Days",label:"More than 90 days",upperValue:(0,i.default)().subtract(90,"days")}];t.default=class{static get DateFilterOptions(){return[{id:"Last24Hours",label:"Last 24 hours",lowerValue:(0,i.default)().subtract(24,"hours")},...a]}static get AntiRaidDateFilterOptions(){return[{id:"Last1Hour",label:"Last 1 hour",lowerValue:(0,i.default)().subtract(1,"hour")},{id:"Last3Hours",label:"Last 1 to 3 hours",lowerValue:(0,i.default)().subtract(3,"hours"),upperValue:(0,i.default)().subtract(1,"hour")},{id:"Last6Hours",label:"Last 3 to 6 hours",lowerValue:(0,i.default)().subtract(6,"hours"),upperValue:(0,i.default)().subtract(3,"hours")},{id:"Last12Hours",label:"Last 6 to 12 hours",lowerValue:(0,i.default)().subtract(12,"hours"),upperValue:(0,i.default)().subtract(6,"hours")},{id:"Last24Hours",label:"Last 12 to 24 hours",lowerValue:(0,i.default)().subtract(24,"hours"),upperValue:(0,i.default)().subtract(12,"hours")},...a]}}},4871:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{static GetWhenFilterParameter(e){const t={};return(null==e?void 0:e.upperValue)&&(t.upperValue=e.upperValue.toISOString()),(null==e?void 0:e.lowerValue)&&(t.lowerValue=e.lowerValue.toISOString()),t}}},8083:function(e,t,r){"use strict";var o=r(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;o(r(14));t.default=class{static Date({value1:e,value2:t}){return e>t}}},8475:function(e,t,r){"use strict";var o=r(0),i=r(19);r(9),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,l=o(r(15)),n=o(r(6)),s=o(r(377)),u=o(r(10126)),d=o(r(1629)),p=o(r(1630)),c=o(r(24)),f=o(r(909)),y=o(r(311)),g=o(r(1406)),h=i(r(10129)),m=o(r(1)),b=(r(2),r(4));function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var T=(0,o(r(10)).default)({name:"BotAuditLog",loader:()=>r(10131)})(a=(0,h.default)(a=(0,b.observer)(a=class extends m.default.Component{constructor(...e){super(...e),this.RenderTriggerType=({item:e})=>(0,n.default)(c.default,{},void 0,p.default[e.triggerType].title),this.RenderActionType=({item:e})=>(0,n.default)(c.default,{},void 0,d.default[e.actionType].title),this.RenderOriginatorName=({item:e})=>{var t;const r=this._getUserId({item:e}),o=this.teamContext.getUser(r);return(0,n.default)(s.default,{className:"BotAuditLog-originator-column",hideUserStatusIcon:!0,hideProfilePicture:!0,user:o,name:o?null:null===(t=e.data.user)||void 0===t?void 0:t.name})},this.RenderWhen=({item:e})=>(0,n.default)(g.default,{timestamp:e.createdAt}),this.RenderError=({item:e})=>e.error?(0,n.default)(u.default,{auditLogItem:e}):null,this.ColumnKeys=[h.BotAuditLogValueKeys.Originator,h.BotAuditLogValueKeys.TriggerType,h.BotAuditLogValueKeys.ActionType,h.BotAuditLogValueKeys.When,h.BotAuditLogValueKeys.Error],this._getIconProps=e=>{const t=this._getUserId({item:e});return{player:this.teamContext.teamInfo?this.teamContext.getUser(t)||new f.default(O({id:e.data.originatorId},e.data)):null,hideOnlineInfo:!0,size:"md"}}}_getUserId({item:e}){return e.data.originatorWebhookId||e.data.originatorId}render(){const{ItemManagementSpecs:e,hasMoreItemsToDisplay:t}=this;return(0,n.default)(y.default,{className:"BotAuditLog-container",items:this.auditActions,hasMoreItemsToDisplay:t,columnKeys:this.ColumnKeys,specs:e,hasLoaded:!this.isLoading&&!this.isMakingRequest,getIconProps:this._getIconProps})}})||a)||a)||a;t.default=T}}]);
//# sourceMappingURL=https://sourcemaps.local.guilded.gg/db0e2dcb/BotAuditLogOverlay~TeamBotsManagerOverlay.js.map