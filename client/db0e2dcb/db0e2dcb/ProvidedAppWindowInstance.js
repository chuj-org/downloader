(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{7913:function(t,e,n){"use strict";var o=n(0);n(9),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n(15)),r=o(n(20)),a=n(14),s=o(n(12)),l=o(n(3)),u=(o(n(13)),o(n(46))),d=o(n(39)),p=o(n(9209)),h=o(n(9232)),c=o(n(71)),f=o(n(113)),w=n(105),v=o(n(44)),g=o(n(1)),_=n(2),C=n(4);let m;var b,y,S,W,I,E,P,M,O,D,L,x,j;function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){(0,i.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const R=["gameContext","groupContext","groupsContext","userContext","statusContext","chatContext","channelsContext","teamChannelContext","teamChannelsContext","teamContext","transientMenuPortalContext","appWindowContext"],N=R.reduce((t,e)=>(t[e]=v.default.object,t),{});var z=(b=_.observable.ref,y=_.observable.ref,(0,u.default)(S=(0,d.default)(S=(0,f.default)(S=(0,C.observer)((m=f.default.Listeners,j=x=class extends g.default.Component{constructor(...t){var e,n,o,i,r;super(...t),n=this,this.isInGame=!!(null===(e=this.props.componentProps)||void 0===e?void 0:e.inGame),(0,s.default)(this,"isClosing",I,this),(0,s.default)(this,"windowId",E,this),(0,s.default)(this,"portalWindow",P,this),(0,s.default)(this,"Component",M,this),this[m]=[{event:c.default.AppExternalPortalWindowReady,action:(r=(0,a.coroutine)((function*({portalWindow:t,portalId:e}){return"".concat(e,"-windowId")===n.windowId&&(0,_.runInAction)(()=>n.portalWindow=new h.default({portalWindow:t,portalId:e,handlesRouteNavigation:!!n.Component.HandlesRouteNavigation}))})),function(t){return r.apply(this,arguments)})},{event:c.default.AppWindowFocusRequest,action:(i=(0,a.coroutine)((function*({windowKey:t}){var e;return t===n.props.windowKey&&(null===(e=n.portalWindow)||void 0===e?void 0:e.Focus())})),function(t){return i.apply(this,arguments)})},{event:c.default.AppWindowCloseRequest,action:(o=(0,a.coroutine)((function*({windowKey:t}){var e;return t===n.props.windowKey&&(null===(e=n.portalWindow)||void 0===e?void 0:e.Close())})),function(t){return o.apply(this,arguments)})}],this.fetchData=(0,a.coroutine)((function*(){const{windowName:t}=n.props;try{return yield p.default.GetAppWindow(t)}catch(t){n.statusContext.displayError({message:"Sorry! Something went wrong - please try again later.",error:t}),n._handleClose()}})),(0,s.default)(this,"handleDataFetch",O,this),(0,s.default)(this,"_handleClose",D,this),(0,s.default)(this,"_handlePortalId",L,this)}getChildContext(){const{windowCallerContext:t,windowProviderContext:e}=this.props,n=R.reduce((n,o)=>(n[o]=t[o]||e[o]||this.context[o],n),{});return n.appWindowContext=this,n.isAppWindowDescendant=!0,n}render(){if(!this.Component)return null;const{componentProps:t}=this.props;return g.default.createElement(this.Component,(0,r.default)({},t,{ref:this._handleRef,onClose:this._handleClose,onConfirm:this._handleConfirm,onGetPortalId:this._handlePortalId}))}componentWillUnmount(){var t,e;super.componentWillUnmount&&super.componentWillUnmount(),null===(t=this.portalWindow)||void 0===t||t.Dispose(),null===(e=this.portalWindow)||void 0===e||e.Close()}},x.childContextTypes=A(A({},N),{},{isAppWindowDescendant:v.default.bool}),x.contextTypes=N,W=j,I=(0,l.default)(W.prototype,"isClosing",[_.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),E=(0,l.default)(W.prototype,"windowId",[_.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=(0,l.default)(W.prototype,"portalWindow",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=(0,l.default)(W.prototype,"Component",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=(0,l.default)(W.prototype,"handleDataFetch",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return t=>{this.Component=t}}}),D=(0,l.default)(W.prototype,"_handleClose",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return(0,a.coroutine)((function*(){const{onClose:e,windowKey:n}=t.props;t.isClosing=!0,yield(0,w.requestAnimationFrameAsync)(),e(n)}))}}),L=(0,l.default)(W.prototype,"_handlePortalId",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e=(0,a.coroutine)((function*(e){t.windowId="".concat(e,"-windowId")}));return function(t){return e.apply(this,arguments)}}()}}),S=W))||S)||S)||S)||S);e.default=z},9209:function(t,e,n){"use strict";var o=n(0),i=n(19);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,a=i(n(14)),s=o(n(892)),l=o(n(17)),u=i(n(7980)),d=o(n(5900)),p={GetAppWindow:(r=(0,a.coroutine)((function*(t){(0,l.default)(d.default[t],"Can't find ".concat(t,"! Did you add it to AppWindow.js?"));const{Component:e}=d.default[t];if((0,u.IsAppWindow)(e))return e;s.default.startLoadingBundle(t);try{const n=(yield e()).default;return(0,u.IsAppWindow)(n)?n:(0,u.default)(n)}finally{s.default.stopLoadingBundle(t)}})),function(t){return r.apply(this,arguments)})};e.default=p},9232:function(t,e,n){"use strict";var o=n(0);n(9),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,r,a,s=o(n(12)),l=o(n(3)),u=(o(n(13)),o(n(372))),d=n(1482),p=n(1665),h=n(677),c=n(756),f=o(n(230)),w=o(n(5897)),v=n(186),g=o(n(190)),_=o(n(262)),C=o(n(38)),m=o(n(71)),b=o(n(162)),y=o(n(17)),S=(o(n(14)),n(2)),W=n(915),I=n(220);let E=(i=S.computed.struct,r=class{constructor({portalId:t,portalWindow:e,handlesRouteNavigation:n}){var o;this._portalId=null,this._appWindowId=null,this._portalWindow=null,this._displayStore=null,this._mouseStateStore=null,this._fileDragStore=null,this._selectionStateStore=null,this._windowObserverDisposer=null,this._handlesRouteNavigation=null,(0,s.default)(this,"_pathStack",a,this),this._topLevelMouseableContentContainer=null,this._isIgnoringMouseEvents=!1,this.Focus=()=>_.default.SendMessage(g.default.Events.FocusPortalWindow,{appWindowId:this._appWindowId}),this.Resize=({height:t,width:e})=>{var n;return null===(n=this._portalWindow)||void 0===n?void 0:n.resizeTo(e,t)},this.Close=({isEscape:t}={})=>C.default.emit(m.default.AppExternalPortalCloseRequest,{portalId:this._portalId,isEscape:t}),this.Dispose=()=>{this._portalWindow.document.removeEventListener("keydown",this._handleEscapePressed)},this.RegisterMouseEventsPassthrough=(t,e)=>{(0,y.default)(t,"contentContainer is required"),t.addEventListener("mouseover",this._onMouseEnter),t.addEventListener("mouseleave",this._onMouseLeave),e&&(this._topLevelMouseableContentContainer=t)},this.UnregisterMouseEventsPassthrough=t=>{(0,y.default)(t,"contentContainer is required"),t.removeEventListener("mouseover",this._onMouseEnter),t.removeEventListener("mouseleave",this._onMouseLeave),t===this._topLevelMouseableContentContainer&&(this._topLevelMouseableContentContainer=null)},this._onMouseEnter=()=>{this._isIgnoringMouseEvents&&(_.default.SendMessage(g.default.Events.UpdatePortalWindowIgnoreMouseEvents,{appWindowId:this._appWindowId,ignoreMouseEvents:!1}),this._isIgnoringMouseEvents=!1)},this._onMouseLeave=()=>{this._isIgnoringMouseEvents||(_.default.SendMessage(g.default.Events.UpdatePortalWindowIgnoreMouseEvents,{appWindowId:this._appWindowId,ignoreMouseEvents:!0}),this._isIgnoringMouseEvents=!0)},this._handleEscapePressed=()=>b.default.EventIsEscape(event)&&this.Close({isEscape:!0}),(0,y.default)(e,"portalWindow is required"),(0,y.default)(t,"portalId is required"),this._portalId=t,this._portalWindow=e,this._handlesRouteNavigation=n,this._displayStore=new v.DisplayStoreClass(e),this._mouseStateStore=new h.MouseStateStoreClass(e),this._fileDragStore=new p.FileDragStoreClass(e),this._selectionStateStore=new c.SelectionStateStoreClass(e),this._appWindowId=null===(o=w.default.GetWindowOptionsInfoFromName(e.name))||void 0===o?void 0:o.appWindowId,(0,d.RegisterWindowEvents)(e),(0,W.RegisterEvents)(e.document),this._portalWindow.document.addEventListener("keydown",this._handleEscapePressed)}get NavigationInfo(){return this.LastPath?f.default.Channel.matches(this.LastPath)||u.default.Channel.matches(this.LastPath):null}get LastPath(){return this._pathStack[this._pathStack.length-1]}get CanHandleRouteNavigation(){return!!this._handlesRouteNavigation}get FileDragStore(){return this._fileDragStore}get Document(){return this._portalWindow.document}get Window(){return this._portalWindow}get DisplayStore(){return this._displayStore}get MouseStateStore(){return this._mouseStateStore}get SelectionStateStore(){return this._selectionStateStore}get AppWindowId(){return this._appWindowId}get SupportsMousePassthrough(){return!!this._topLevelMouseableContentContainer}get EmulatedPortalContainerSpecs(){if(!this.SupportsMousePassthrough)return{};const t=this._topLevelMouseableContentContainer;return{portalTriggerContainer:(0,I.GetEmulatedContainerAtElementCenter)(t),portalAlignment:"bottom-center",portalAlignmentSpecs:{boundingContainer:t}}}Navigate(t){this._pathStack[this._pathStack.length-1]!==t&&(this._pathStack=[...this._pathStack,t])}GoBack(){this._pathStack.splice(this._pathStack.length-1,1)}},a=(0,l.default)(r.prototype,"_pathStack",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),(0,l.default)(r.prototype,"NavigationInfo",[i],Object.getOwnPropertyDescriptor(r.prototype,"NavigationInfo"),r.prototype),(0,l.default)(r.prototype,"LastPath",[S.computed],Object.getOwnPropertyDescriptor(r.prototype,"LastPath"),r.prototype),(0,l.default)(r.prototype,"Navigate",[S.action],Object.getOwnPropertyDescriptor(r.prototype,"Navigate"),r.prototype),(0,l.default)(r.prototype,"GoBack",[S.action],Object.getOwnPropertyDescriptor(r.prototype,"GoBack"),r.prototype),r);e.default=E}}]);
//# sourceMappingURL=https://sourcemaps.local.guilded.gg/db0e2dcb/ProvidedAppWindowInstance.js.map