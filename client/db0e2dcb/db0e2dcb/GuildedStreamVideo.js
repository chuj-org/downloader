(window.webpackJsonp=window.webpackJsonp||[]).push([[101],{10782:function(e,t,a){"use strict";var r=a(0),i=a(19);a(9),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,n,s,l,d,u,c,p,h,m,f=r(a(6)),y=i(a(14)),v=r(a(12)),S=r(a(3)),g=(r(a(13)),a(23)),b=r(a(73)),P=r(a(81)),w=r(a(43)),k=r(a(109)),I=r(a(37)),V=r(a(11)),_=r(a(1)),O=a(2),E=a(4),M=r(a(10783)),U=r(a(10));const T=1001;var D=(0,U.default)({name:"GuildedStreamVideo",loader:()=>a(10784)})(o=(0,I.default)(o=(0,E.observer)((m=h=class e extends _.default.Component{constructor(...e){var t;super(...e),t=this,this.reactions=[{dataFn:()=>this.rawStreamSource,reaction:e=>e&&this._setStreamSource(),fireImmediately:!1},{dataFn:()=>this.manifestUrl,reaction:e=>e&&this._setManifestSource(),fireImmediately:!1},{dataFn:()=>this.isMuted,reaction:e=>this.SetVolume(e?0:this.lastVolume),fireImmediately:!1},{dataFn:()=>this.props.volume,reaction:e=>this.SetVolume(e),fireImmediately:!1},{dataFn:()=>this.props.sinkId,reaction:e=>this.setOutputSinkId(e),fireImmediately:!1}],this.mediaPlayer=null,this.video=null,this.lastSyncIdPromise=null,this.lastVolume=this.props.volume||0,(0,v.default)(this,"isVideoLoaded",s,this),(0,v.default)(this,"hasPlaybackStarted",l,this),this.Play=()=>{if(this.video){const e=this.video.play();(null==e?void 0:e.catch)&&e.catch(e=>{var t;(null===(t=this.video)||void 0===t?void 0:t.volume)&&(this.SetVolume(0),this.Play())})}},this.Pause=()=>{var e;null===(e=this.video)||void 0===e||e.pause()},this.SetVolume=e=>{e=Math.min(1,e||0),this.lastVolume=e,this.video&&(this.video.volume=e,this.video.muted=0===e)},this.ChangeVideoTrack=e=>{var t,a;if(!e)return!1;const r=null===(t=this.mediaPlayer)||void 0===t?void 0:t.getVariantTracks(),i=null==r?void 0:r.find(t=>t.id===e.id);return i&&(null===(a=this.mediaPlayer)||void 0===a||a.selectVariantTrack(i)),!!i},(0,v.default)(this,"_handleStreamMetaLoaded",d,this),this._handleVideoRef=e=>{if(this.video=e,this.setOutputSinkId(this.props.sinkId),e){const{manifestUrl:e,rawStreamSource:t}=this;t?this._setStreamSource():e&&this._setManifestSource(),this.SetVolume(this.lastVolume)}},this._setStreamSource=()=>{const{rawStreamSource:e}=this;this.video&&(this.video.srcObject=e)},this._setManifestSource=(0,y.coroutine)((function*(){const{manifestUrl:e,video:a,playerConfiguration:r}=t;if(a)try{var i;null===(i=t.mediaPlayer)||void 0===i||i.destroy(),t.mediaPlayer=new M.default.Player(a),t.mediaPlayer.addEventListener("error",t._onPlayerError),t.mediaPlayer.getNetworkingEngine().registerRequestFilter((e,t)=>{t.allowCrossSiteCredentials=e===M.default.net.NetworkingEngine.RequestType.SEGMENT||e===M.default.net.NetworkingEngine.RequestType.MANIFEST||e===M.default.net.NetworkingEngine.RequestType.TIMING}),t.mediaPlayer.configure(r),yield t.mediaPlayer.load(e)}catch(e){var o,n;null===(o=(n=t.props).onError)||void 0===o||o.call(n)}})),(0,v.default)(this,"_handleVideoPlaybackStarted",u,this),(0,v.default)(this,"_handlePlaybackEnded",c,this),(0,v.default)(this,"_handleOnPause",p,this),this._onPlayerError=function(){var e=(0,y.coroutine)((function*(e){var a,r;e.detail.code!==T&&(null===(a=(r=t.props).onError)||void 0===a||a.call(r))}));return function(t){return e.apply(this,arguments)}}(),this._handleOnClick=e=>{var t,a;(0,g.stopEventPropagationAndDefault)(e),null===(t=(a=this.props).onClick)||void 0===t||t.call(a)},this.setOutputSinkId=function(){var e=(0,y.coroutine)((function*(e){const{video:a,lastSyncIdPromise:r}=t;if(e=e||"",a&&e!==a.sinkId)try{r&&(yield r),t.lastSyncIdPromise=a.setSinkId(e).then(()=>t.lastSyncIdPromise=null)}catch(e){t.lastSyncIdPromise=null}}));return function(t){return e.apply(this,arguments)}}()}render(){const{className:e,responsiveDimension:t="width",dark:a}=this.props,{autoPlay:r,hasPlaybackStarted:i,isVideoLoaded:o,isMuted:n}=this;return(0,f.default)(_.default.Fragment,{},void 0,_.default.createElement("video",{className:(0,V.default)("GuildedStreamVideo-container",e,{["GuildedStreamVideo-container-responsive-".concat(t)]:!!t,"GuildedStreamVideo-container-dark":a}),ref:this._handleVideoRef,autoPlay:r,onPlaying:i?null:this._handleVideoPlaybackStarted,onPause:this._handleOnPause,onEnded:this._handlePlaybackEnded,onLoadedData:this._handleVideoDataLoaded,onLoadedMetadata:this._handleStreamMetaLoaded,controls:!1,muted:!!n&&"muted",onClick:this._handleOnClick}),!o&&(0,f.default)("div",{className:(0,V.default)("GuildedStreamVideo-loading-animation-wrapper",e)},void 0,(0,f.default)(k.default,{fudgeTop:15,white:!0})))}get isMuted(){const{muted:e=!0}=this.props;return e}get streamKey(){const{stream:{userId:e,streamKey:t}}=this.props;return t||e}get streamEdgeInfo(){return this.props.stream.streamEdgeInfo}get baseStreamUrl(){const{streamEdgeInfo:e}=this;return w.default.IsDev?"http://".concat(null==e?void 0:e.streamIp,":8005/live"):"https://".concat(null==e?void 0:e.streamIp,"/live")}get dashStreamUrl(){const{streamKey:e,baseStreamUrl:t}=this;return e?"".concat(t,"/").concat(e,"/index.mpd"):null}get hlsStreamUrl(){const{streamKey:e,baseStreamUrl:t}=this;return e?"".concat(t,"/").concat(e,"/master.m3u8"):null}get manifestUrl(){const{hlsStreamUrl:e,dashStreamUrl:t,streamEdgeInfo:a}=this;return a?P.default.TeamStreamHls?e:t:null}get rawStreamSource(){return this.props.stream.rawStream}get autoPlay(){const{autoPlay:e=!0}=this.props;return e}get playerConfiguration(){const{enableAbr:e=!1}=this.props,t={timeout:0,maxAttempts:15,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5};return{abr:{enabled:e},streaming:{bufferBehind:4,bufferingGoal:4,rebufferingGoal:2,durationBackoff:1,startAtSegmentBoundary:!1,smallGapLimit:.5,retryParameters:t},manifest:{retryParameters:t,dash:{clockSyncUri:"".concat(b.default.BaseVideoUrl,"/time"),defaultPresentationDelay:10,autoCorrectDrift:!0,ignoreMinBufferTime:!0}}}}componentDidMount(){e.BootstrapShaka()}componentWillUnmount(){var e,t;null===(e=this.mediaPlayer)||void 0===e||e.removeEventListener("error",this._onPlayerError),null===(t=this.mediaPlayer)||void 0===t||t.destroy()}static BootstrapShaka(){e.IsBootstrapped||(e.IsBootstrapped=!0,M.default.polyfill.installAll())}},h.IsBootstrapped=!1,n=m,s=(0,S.default)(n.prototype,"isVideoLoaded",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l=(0,S.default)(n.prototype,"hasPlaybackStarted",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),(0,S.default)(n.prototype,"isMuted",[O.computed],Object.getOwnPropertyDescriptor(n.prototype,"isMuted"),n.prototype),(0,S.default)(n.prototype,"streamKey",[O.computed],Object.getOwnPropertyDescriptor(n.prototype,"streamKey"),n.prototype),(0,S.default)(n.prototype,"streamEdgeInfo",[O.computed],Object.getOwnPropertyDescriptor(n.prototype,"streamEdgeInfo"),n.prototype),(0,S.default)(n.prototype,"baseStreamUrl",[O.computed],Object.getOwnPropertyDescriptor(n.prototype,"baseStreamUrl"),n.prototype),(0,S.default)(n.prototype,"dashStreamUrl",[O.computed],Object.getOwnPropertyDescriptor(n.prototype,"dashStreamUrl"),n.prototype),(0,S.default)(n.prototype,"hlsStreamUrl",[O.computed],Object.getOwnPropertyDescriptor(n.prototype,"hlsStreamUrl"),n.prototype),(0,S.default)(n.prototype,"manifestUrl",[O.computed],Object.getOwnPropertyDescriptor(n.prototype,"manifestUrl"),n.prototype),(0,S.default)(n.prototype,"rawStreamSource",[O.computed],Object.getOwnPropertyDescriptor(n.prototype,"rawStreamSource"),n.prototype),(0,S.default)(n.prototype,"autoPlay",[O.computed],Object.getOwnPropertyDescriptor(n.prototype,"autoPlay"),n.prototype),d=(0,S.default)(n.prototype,"_handleStreamMetaLoaded",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return e=>{var t,a,r,i;const o=e.currentTarget.videoHeight,n=e.currentTarget.videoWidth;let s=null===(t=this.mediaPlayer)||void 0===t?void 0:t.getVariantTracks().filter(e=>e.videoCodec);const l=null===(a=s)||void 0===a?void 0:a.find(e=>e.active);s=(s||[]).map(({id:e,videoId:t,codec:a,mimeType:r,height:i,width:o})=>({id:e,type:"video",codec:a,height:i,width:o,videoId:t,isSource:1===t}));const d=s.find(e=>e.isSource);s=d?s.filter(e=>e.isSource||e.height<(null==d?void 0:d.height)):s,this.videoMetadata={height:o,width:n,aspectRatio:n/o,videoTracks:s,currentVideoTrack:l},null===(r=(i=this.props).onVideoInfoChanged)||void 0===r||r.call(i,this.videoMetadata)}}}),u=(0,S.default)(n.prototype,"_handleVideoPlaybackStarted",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return()=>{var e,t;this.hasPlaybackStarted||(this.hasPlaybackStarted=!0,this.isVideoLoaded=!0,null===(e=(t=this.props).onPlaybackStarted)||void 0===e||e.call(t))}}}),c=(0,S.default)(n.prototype,"_handlePlaybackEnded",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return()=>this.isPaused=!0}}),p=(0,S.default)(n.prototype,"_handleOnPause",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return()=>this.isPaused=!0}}),o=n))||o)||o)||o;t.default=D},10784:function(e,t,a){var r=a(7),i=a(10785);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var o,n=0,s={injectType:"lazyStyleTag",insert:"head",singleton:!1},l={};i.locals&&(l.locals=i.locals),l.use=function(e){return n++||(o=r(i,{...s,...e})),l},l.unuse=function(){n>0&&!--n&&(o(),o=null)},e.exports=l},10785:function(e,t,a){(t=a(8)(!1)).push([e.i,".GuildedStreamVideo-container{width:100%;height:auto;max-height:100%;max-width:100%;vertical-align:middle}.GuildedStreamVideo-container-responsive-height{width:auto;height:100%;max-width:100%}.GuildedStreamVideo-loading-animation-wrapper{position:absolute;margin:auto;flex:0 0 auto;height:100%;width:100%;display:flex;top:0;align-items:center;justify-content:center}.GuildedStreamVideo-container-dark{background:#000}",""]),e.exports=t}}]);
//# sourceMappingURL=https://sourcemaps.local.guilded.gg/db0e2dcb/GuildedStreamVideo.js.map